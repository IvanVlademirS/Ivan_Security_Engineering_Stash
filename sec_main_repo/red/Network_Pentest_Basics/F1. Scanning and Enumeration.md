*Using Kioptrix* : [https://tcm-sec.com/kioptrix](https://tcm-sec.com/kioptrix)
- login: `john :: TwoCows2`
- this is an OLD machine
- using ping to identify kioptrix IP
- in Kali, use `arp-scan -l` to verify IP matches (look for VMware)

# Scanning with Nmap
❗️ do scans in parallel with osint >> work on other things while scan is going
- obtain your IP in kali
- use netdiscover to mac scan on network `netdiscover -r [IP subnet]`
#### NMAP
- use man or --help for reference
- stealth scan/TCP scan `-sS`
	- UDP scan `-sU`
		- typically scan top 1000 ports, otherwise UDP takes forever
		- `nmap -sU -T4- -p [insert IP]`
- heath default `nmap -T4- -p- -A [insert IP]`
	- T4 = speed
	- -p- = all ports, if you leave out -p it scans all well-known ports
		- for specific port(s): `-p 80, 443, 53`
	- -A = all information, slow
- look for open ports and what's running

# Enumerating HTTP and HTTPS
- from kioptrix scan: port 80, 443, and 139 are common with exploits
- take good notes as you do each step, take screenshots
- 80, 443:
	- if you see a website, go to the website >> take kioptrix IP and open in browser
	- Is there a default webpage? are there any other web directories?
	- any versions, host names?
	- can use nikto
	- #### Nikto
		- web vuln scanner
		- `nikto -h http://[insert IP]`
		- look through results and highlight key interests, can save output, screenshot to notes
	- #### dirbuster , gobuster
		- heath prefer dirbuster >> use both
		- `dirbuster&` >> launches GUI
			- input target url/IP >> go faster >> browse list (/ /usr/share/wordlists/dirbuster)
				- start with small list then move up
			- choose proper file extension based on recon and scan findings
			- may take a while to scan depending on parameters
		- findings can be a rabbit hole > dig through results to find meaningful info
		- 
	- can use burp suite to analyze requests
		- intercept > can send to repeater (modify results and test)
		- check headers for information disclosure
	- view source code in browser to find comments, keys, passwds
1. Look for service version info
2. backend directories
3. source code
4. potential vulns with nikto

# Enumerating SMB
SMB (fileshare) on port 139 >> look to see if you can access any files on the share(s)
#### Metasploit
- metasploit - launch with `msfconsole`
	- long way: `search smb` >> search for smb module with version
	- auxiliary modules are enumeration 
	- start by `use [enter module number or name]`
	- check options `options`
	- RHOSTS = victim
		- `set RHOSTS [insert IP]`
		- start: `run`
	- identify and note any new info
#### smbclient
- attempt to connect to fileshare
	- can check for anonymous login
- `smbclient -L \\\\[insert IP]`
	- look for any interesting sharenames and comments
	- can try connecting after finding share names: `smbclient \\\\[insert IP]\\ADMIN$`
	- if login successful, then anonymous login is possible
		- can check until dead-end >> will maybe get lucky

# Enumerating SSH
take SSH info from scan
- any password attempts against ssh is exploitation phase
- for older machine, may need to add syntax to SSH
	- `ssh [IP] -oKexAlgorithms=+diffie-hellman-group1-sha1 -c aes128-cbc`
- attempt to make connection to see if a banner is exposed, may give information

# Researching Potential Vulnerabilities
- 80/443 - 192.168.57.134
- default webpage - apache - php
- information disclosure - 404 page
- information disclosure - server headers disclose version info

- 80/tcp     open  http     Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)

- mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-0082 OSVDB-756

- SMB
	- Unix (Samba 2.2.1a)

- Webalizer Version 2.01 - http://192.168.57.134/usage/usage_201911.html

- SSH
	- OpenSSH 2.9p2

priority order: 80 > 443 > SMB 139/445 > webalizer > ssh
- use notes to research in browser , ex:` apache httpd 1.3.20 exploit`
- check exploit-db
- make notes for vulns based on research
	- 80/443 - potentially vulnerable for OpenLuck: https://github.com/heltonWernik/OpenLuck
	- if you see anything from rapid7 - check since u can maybe use metasploit
	- 139 - potentially vulnerable to trans2open: https://www.rapid7.com/db/modules/exploit/linux/samba/trans2open/
- if no internet access, can use terminal
	- use searchsploit `searchsploit Samba 2`
		- do not be too specific with searchsploit, it uses the EXACT string
	- remote is juicy

# Our Notes So Far (Kioptrix)
Use a directory hierarchy >> create and put all notes, links, & screenshots:
- Kioptrix (192.168.57.134)
	- nmap
		- 22
		- 80/443
			- nikto
		- 139
	- exploitation
	- findings
		- default web page - apache
		- information disclosure





