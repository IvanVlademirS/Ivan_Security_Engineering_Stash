*we have cracked the hash(es), create account with mitm6 >> we are in, now we need to enumerate the network*

# PowerView
*empire is now deprecated* - https://github.com/PowerShellEmpire/PowerTools
Forked version of empire >> being maintained: https://github.com/BC-SECURITY/Empire

## Domain Enumeration with PowerView
cheatsheet: PowerView Cheat Sheet: [https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993](https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993)
```powershell
cd Downloads #wherever powerview is installed
powershell -ep bypass #bypass execution policy
. .\PowerView.ps1 #start program
Get-NetDomain
Get-NetDomainController
Get-DomainPolicy
(Get-DomainPolicy)."system access" #more details about policy
Get-NetUser #may find interesting description with passwords, may need to use | select if too many users
Get-NetUser | select cn #show only users
Get-NetUser | select samaccountname #show only account names
Get-NetUser | select description #descriptions

Get-UserProperty #shows user properties
Get-UserProperty -Properties pwdlastset
Get-UserProperty -Properties logoncount #can identify honeypots if never logged in
Get-UserProperty -Properties badpwdcount

Get-NetComputer #machine info
Get-NetComputer -FullData # a lot of info
Get-NetComputer -FullData | select OperatingSystem

Get-NetGroup #built-in groups
Get-NetGroup -GroupName "Domain Admins"

Get-NetGroup -GroupName *admin*
Get-NetGroupMember -GroupName "Domain Admins"

#invoke tool
Invoke-ShareFinder #identify juicy shares

Get-NetGPO #show group policies
Get-NetGPO | select displayname, whenchanged
```

# Bloodhound Overview and Setup
Downloads AD data and visualizes in graph
Install
```bash
apt install bloodhound
#bh runs on neo4j > need to set this up too
neo4j console #open webapp localhost -- user/pass = neo4j

#open bh
bloodhound #login with neo4j/[pass]
```

## Grabbing data with invoke-Bloodhound
need to set up ingester
put on WIN machine >> https://github.com/puckiestyle/powershell/blob/master/SharpHound.ps1
in WIN
```powershell
-ep bypass
. .\SharpHound.ps1
Invoke-BloodHound -collectionMethod All -Domain MARVEL.local -ZipFileName file.zip #copy data to local > then add to kali
```

## Enumerating domain data with Bloodhound
in bloodhound >> upload data (file.zip) >> click on hamburger to view
- database info
- pre-built queries
	- try to find and target boxes where domain admin is logged in
- node info

❗️ Takeaway:
- use powerview to look for users, groups, group policies, computer policies
- use bloodhound to look at admins in the network, what admins are on what machine, what is my shortest path to domain admin, what are my high value targets
