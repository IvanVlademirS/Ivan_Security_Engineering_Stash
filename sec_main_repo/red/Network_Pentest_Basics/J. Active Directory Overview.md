# Overview
**What is AD?**
- Directory service developed by Microsoft to manage windows domain networks
- Stores info related to objects, such as computers, users, printers, etc
	- think about it as a phonebook for windows
- Authenticates using `Kerberos` tickets
	- non-windows devices, such as linux machine, firewalls, etc can also authenticate to AD via `RADIUS` or `LDAP`

**Why AD?**
- AD is the most commonly used identity management service in the world
	- 95% of Fortune 1000 companies implement the service in their networks
- Can be exploited without ever attacking patchable exploits
	- instead, we abuse features, trusts, components, and more

❗️ Defenses come down to proper policies in place

# Physical Active Directory Components
### Domain Controllers
- AD DS = active directory domain services
- a DC is a server with the AD DS (directory store {phonebook}) server role installed that has specifically been promoted to a domain controller
- Domain Controllers:
	- host a copy of the AD DS directory store
	- provide authentication and authorization services
	- replicate updates to other domain controllers in the domain and forest
	- allow admin access to manage user accounts and network resources

### AD DS Data Store
- the AD DS data store contains the database files and processes that store and manage directory information for users, services, and applications
- AD DS data store:
	- consists of the `Ntds.dit` file (contains everything stored in AD data, has password hashes)
	- is stored by default in the `%SystemRoot%\NTDS` folder on all domain controllers
	- is accessible only through the domain controller processes and protocols

# Logical Active Directory Components
### AD DS Schema
Think of a rulebook or a blueprint
- The AD DS Schema:
	- define every type of object that can be stored in the directory
	- enforces rules regarding object creation and configuration
- Object types:
	- class object: what objects can be created in the directory
		- user
		- computer
	- attribute object: info that can be attached to an object
		- display name

### Domains
What is used to group things together
Domains are used to group and manage objects in an organization
- Domains:
	- an administrative boundary for applying policies to groups of objects
	- a replication boundary for replicating data between domain controllers
	- an authentication and authorization boundary that provides a way to limit the scope of access to resources

### Trees
A group of domains
A domain tree is a hierarchy of domains in AD DS
- All domains in the tree:
	- share a contiguous namespace with the parent domain
	- can have additional child domains
	- by default create a two-way transitive trust with other domains

### Forest
A collection of one or more domain trees
- Forests:
	- share a common schema
	- share a common config partition
	- share a common global catalog to enable searching
	- enable trusts between all domains in the forest
	- share the enterprise admins and schema admins group

### Organizational Units (O'us)
OUs are AD containers that can contain users, groups, computers, and other OUs
- OUs are used to:
	- represent your organization hierarchically and logically
	- manage a collection of objects in a consistent way
	- delegate permissions to administer groups of objects
	- apply policies

### Trusts
How we have access between resources in other domains
Trusts provide a mechanism for users to gain access to resources in another domain
- Types
	- directional: trust direction flows from `trusting domain to the trusted domain`
	- transitive - trust relationship is extended beyond a two-domain trust to include other trusted domains
- all domains in a forest trust all other domains in the forest
- trusts can extend outside the forest

### Objects
What is inside our OUs
- user - enables network resource access for a user
- InetOrgPerson - similar to a user account, used for compatibility with other directory services
- Contacts - used primarily to assign e-mail addresses to external users, does not enable network access
- Groups - used to simplify the administration of access control
- Computers - enabled authentication and auditing of computer access to resources
- Printers - used to simplify the process of locating and connecting to printers
- Shared Folders - enables users to search for shared folders based on propeties

## Can build the lab in Azure
Ethical Hacking Lessons — Building Free Active Directory Lab in Azure - [https://kamran-bilgrami.medium.com/ethical-hacking-lessons-building-free-active-directory-lab-in-azure-6c67a7eddd7f](https://kamran-bilgrami.medium.com/ethical-hacking-lessons-building-free-active-directory-lab-in-azure-6c67a7eddd7f)



